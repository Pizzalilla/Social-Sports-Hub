<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:Social_Sport_Hub.ViewModels"
             x:Class="Social_Sport_Hub.Views.EventsPage"
             Title="All Games"
             BackgroundColor="#FAFAFA">

    <Grid RowDefinitions="Auto,Auto,*">

        <!-- Compact Square Filter Toggle Button -->
        <Frame Grid.Row="0"
               Margin="15,10,15,10"
               Padding="0"
               BackgroundColor="White"
               CornerRadius="12"
               HasShadow="True"
               BorderColor="#E0E0E0"
               HorizontalOptions="Start">
            <Grid ColumnDefinitions="Auto,Auto" Padding="12">

                <!-- Filter Icon -->
                <Frame WidthRequest="32" 
                       HeightRequest="32"
                       BackgroundColor="#6C63FF"
                       CornerRadius="16"
                       Padding="0"
                       HasShadow="False"
                       VerticalOptions="Center">
                    <Label Text="ðŸ”" 
                           FontSize="16"
                           HorizontalOptions="Center"
                           VerticalOptions="Center"/>
                </Frame>

                <!-- Chevron Icon -->
                <Label x:Name="ChevronIcon"
                       Grid.Column="1"
                       Text="â–¼"
                       FontSize="16"
                       TextColor="#6C63FF"
                       VerticalOptions="Center"
                       Margin="8,0,0,0"
                       Rotation="0"/>

                <!-- Tap Gesture -->
                <Grid.GestureRecognizers>
                    <TapGestureRecognizer Tapped="OnToggleFilterClicked"/>
                </Grid.GestureRecognizers>
            </Grid>
        </Frame>

        <!-- Filter Section (Initially Hidden) -->
        <Frame Grid.Row="1" 
       x:Name="FilterFrame"
       IsVisible="False"
       Margin="15,0,15,10" 
       Padding="15" 
       BackgroundColor="White" 
       CornerRadius="15" 
       HasShadow="True"
       BorderColor="#E0E0E0">
            <VerticalStackLayout Spacing="12">
                <Label Text="Filter by Sport" 
               FontSize="16" 
               FontAttributes="Bold" 
               TextColor="#222"/>

                <Grid ColumnDefinitions="*,Auto,Auto" ColumnSpacing="8">
                    <Picker x:Name="SportFilterPicker"
                    Title="All Sports"
                    FontSize="14"
                    TextColor="#333">
                        <Picker.ItemsSource>
                            <x:Array Type="{x:Type x:String}">
                                <x:String>All Sports</x:String>
                                <x:String>Soccer</x:String>
                                <x:String>Basketball</x:String>
                                <x:String>Cricket</x:String>
                                <x:String>Tennis</x:String>
                                <x:String>Volleyball</x:String>
                                <x:String>Rugby</x:String>
                                <x:String>Running</x:String>
                                <x:String>Other</x:String>
                            </x:Array>
                        </Picker.ItemsSource>
                    </Picker>

                    <Button Grid.Column="1"
                    Text="Apply"
                    Command="{Binding FilterEventsBySportCommand}"
                    CommandParameter="{Binding Source={x:Reference SportFilterPicker}, Path=SelectedItem}"
                    BackgroundColor="#6C63FF"
                    TextColor="White"
                    WidthRequest="90"
                    HeightRequest="44"
                    CornerRadius="10"
                    FontSize="14"
                    FontAttributes="Bold"/>

                    <Button Grid.Column="2"
                    Text="Clear"
                    Command="{Binding LoadEventsCommand}"
                    BackgroundColor="#FF6B6B"
                    TextColor="White"
                    WidthRequest="80"
                    HeightRequest="44"
                    CornerRadius="10"
                    FontSize="14"
                    FontAttributes="Bold"/>
                </Grid>
            </VerticalStackLayout>
        </Frame>

        
        <!-- Events List -->
        <RefreshView Grid.Row="2" 
                     Command="{Binding LoadEventsCommand}" 
                     IsRefreshing="{Binding IsBusy}">
            <CollectionView ItemsSource="{Binding Events}"
                            Margin="15,0,15,15"
                            VerticalScrollBarVisibility="Never"
                            SelectionMode="None">

                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame Margin="0,0,0,12"
               Padding="16"
               BackgroundColor="White"
               BorderColor="#E0E0E0"
               CornerRadius="16"
               HasShadow="True">

                            <Grid RowDefinitions="Auto,Auto" 
                  RowSpacing="12">

                                <!-- Top Row: Details & Capacity (No Icon) -->
                                <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">

                                    <!-- Event Details -->
                                    <VerticalStackLayout Spacing="4" 
                                         VerticalOptions="Center">
                                        <Label Text="{Binding Event.Title}" 
                                           FontSize="18" 
                                           FontAttributes="Bold" 
                                           TextColor="#222"
                                           LineBreakMode="TailTruncation"
                                           MaxLines="1"/>
                                                <Label Text="{Binding Event.Address}" 
                                           FontSize="13" 
                                           TextColor="#666"
                                           LineBreakMode="TailTruncation"
                                           MaxLines="1"/>       
                                        <HorizontalStackLayout Spacing="8">
                                            <Label Text="{Binding Event.StartTimeUtc, StringFormat='{0:MMM dd, h:mm tt}'}"
                                               FontSize="12" 
                                               TextColor="#888"/>
                                                        <Label Text="â€¢" 
                                               FontSize="12" 
                                               TextColor="#CCC"/>
                                                        <Label Text="{Binding Event.SportType}" 
                                               FontSize="12" 
                                               TextColor="#6C63FF"
                                               FontAttributes="Bold"/>
                                            </HorizontalStackLayout>
                                        </VerticalStackLayout>

                                    <!-- Capacity Badge -->
                                    <Frame Grid.Column="1"
                                       BackgroundColor="#6C63FF"
                                       CornerRadius="12"
                                       Padding="10,6"
                                       VerticalOptions="Start"
                                       HasShadow="False">
                                                    <Label Text="{Binding CapacityDisplay}"
                                           TextColor="White"
                                           FontSize="13"
                                           FontAttributes="Bold"/>
                                    </Frame>
                                </Grid>

                                <!-- Bottom Row: View Details Button -->
                                <Button Grid.Row="1"
                                    Text="View Details"
                                    BackgroundColor="#6C63FF"
                                    TextColor="White"
                                    FontAttributes="Bold"
                                    CornerRadius="10"
                                    HeightRequest="44"
                                    Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:EventsViewModel}},
                                                      Path=ViewEventDetailsCommand}"
                                    CommandParameter="{Binding Event}" />

                                </Grid>
                            </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </RefreshView>
    </Grid>
</ContentPage>